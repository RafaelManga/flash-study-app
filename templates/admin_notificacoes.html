{% extends "base.html" %}
{% block title %}Notifica√ß√µes - Admin{% endblock %}

{% block content %}
<div style="margin-bottom: 40px;">
    <h1 style="font-size: 2.5rem; margin-bottom: 16px;">üì¢ Sistema de Notifica√ß√µes</h1>
    <p style="color: var(--muted);">Envie avisos e comunicados para os usu√°rios</p>
</div>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
    <!-- Enviar Notifica√ß√£o -->
    <div class="card">
        <h2 style="margin-bottom: 20px;">üì§ Enviar Notifica√ß√£o</h2>
        
        <form method="POST">
            <div style="margin-bottom: 20px;">
                <label class="form-label">Destinat√°rios *</label>
                <select name="destinatarios" class="form-control" required>
                    <option value="todos">üë• Todos os usu√°rios</option>
                    <option value="admins">üõ°Ô∏è Apenas administradores</option>
                    <option value="ativos">üü¢ Usu√°rios ativos (√∫ltimos 7 dias)</option>
                    <option value="inativos">‚ö´ Usu√°rios inativos (+30 dias)</option>
                </select>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label class="form-label">Tipo de Notifica√ß√£o</label>
                <select name="tipo" class="form-control">
                    <option value="info">‚ÑπÔ∏è Informa√ß√£o</option>
                    <option value="aviso">‚ö†Ô∏è Aviso</option>
                    <option value="sucesso">‚úÖ Sucesso</option>
                    <option value="urgente">üö® Urgente</option>
                </select>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label class="form-label">T√≠tulo *</label>
                <input type="text" name="titulo" class="form-control" required 
                       placeholder="Ex: Nova funcionalidade dispon√≠vel!">
            </div>
            
            <div style="margin-bottom: 20px;">
                <label class="form-label">Mensagem *</label>
                <textarea name="mensagem" class="form-control" rows="6" required
                          placeholder="Digite a mensagem da notifica√ß√£o..."></textarea>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label class="form-label">Link (opcional)</label>
                <input type="text" name="link" class="form-control" 
                       placeholder="/feed ou URL externa">
                <p style="color: var(--muted); font-size: 0.9rem; margin-top: 8px;">
                    Deixe em branco se n√£o houver link
                </p>
            </div>
            
            <button type="submit" class="btn btn-primary" style="width: 100%;">
                üì¢ Enviar Notifica√ß√£o
            </button>
        </form>
    </div>
    
    <!-- Hist√≥rico de Notifica√ß√µes -->
    <div>
        <div class="card">
            <h2 style="margin-bottom: 20px;">üìú Hist√≥rico de Notifica√ß√µes</h2>
            
            {% if notificacoes %}
                <div style="max-height: 600px; overflow-y: auto;">
                    {% for notif in notificacoes %}
                    <div style="padding: 16px; border-bottom: 1px solid var(--border); margin-bottom: 12px;">
                        <div style="display: flex; gap: 8px; margin-bottom: 8px;">
                            {% if notif.tipo == 'info' %}
                                <span class="badge" style="background: #3b82f6;">‚ÑπÔ∏è</span>
                            {% elif notif.tipo == 'aviso' %}
                                <span class="badge" style="background: #f59e0b;">‚ö†Ô∏è</span>
                            {% elif notif.tipo == 'sucesso' %}
                                <span class="badge" style="background: #10b981;">‚úÖ</span>
                            {% else %}
                                <span class="badge" style="background: #ef4444;">üö®</span>
                            {% endif %}
                            
                            <span style="color: var(--muted); font-size: 0.9rem;">
                                {{ notif.data|datetime('%d/%m/%Y %H:%M') }}
                            </span>
                        </div>
                        
                        <h4 style="margin-bottom: 8px;">{{ notif.titulo }}</h4>
                        <p style="color: var(--muted); margin-bottom: 8px; line-height: 1.5;">
                            {{ notif.mensagem }}
                        </p>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="color: var(--muted); font-size: 0.9rem;">
                                üë• {{ notif.destinatarios_texto }}
                            </span>
                            
                            {% if notif.link %}
                            <a href="{{ notif.link }}" class="btn btn-secondary" style="font-size: 0.9rem; padding: 4px 12px;">
                                üîó Link
                            </a>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div style="text-align: center; padding: 40px 20px; color: var(--muted);">
                    <div style="font-size: 3rem; margin-bottom: 12px; opacity: 0.5;">üì≠</div>
                    <p>Nenhuma notifica√ß√£o enviada ainda</p>
                </div>
            {% endif %}
        </div>
        
        <!-- Estat√≠sticas -->
        <div class="card" style="margin-top: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
            <h3 style="margin-bottom: 16px;">üìä Estat√≠sticas</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                <div>
                    <div style="font-size: 2rem; font-weight: bold; margin-bottom: 4px;">{{ total_notificacoes }}</div>
                    <div style="opacity: 0.9;">Total Enviadas</div>
                </div>
                <div>
                    <div style="font-size: 2rem; font-weight: bold; margin-bottom: 4px;">{{ notificacoes_mes }}</div>
                    <div style="opacity: 0.9;">Este M√™s</div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
